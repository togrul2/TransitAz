{% extends 'main.html' %}
{% load static %}
{% block title %}Biletlər{% endblock %}

{% block head %}
<link rel="stylesheet" href="{% static 'css/dashboard.css' %}">

{% endblock %}

{% block body %}

<div class="wrapper my-3">
    <h1 class="mx-5">Biletler</h1>
    <div class="choice-wrapper mx-lg-5">
        <div class="forms">
            <form action="{% url 'search-tickets' %}" method="get">
                <h1>Bilet elde edin</h1>
                <div class="btn-group" role="group" aria-label="Basic radio toggle button group">
                    <input type="radio" class="btn-check radio-choice" name="radio-choice" id="radio-bus"
                        value="bus-search" autocomplete="off" checked>
                    <label class="btn btn-outline-primary" for="radio-bus">Avtobus</label>

                    <input type="radio" class="btn-check radio-choice" name="radio-choice" id="radio-train"
                        value="train-search" autocomplete="off">
                    <label class="btn btn-outline-primary" for="radio-train">Qatar</label>
                </div>
                <div class="mt-3 form-wrapper form-bus">
                    <div class="row ps-1">
                        <h5>Avtobus bileti</h5>
                    </div>
                    <div class="row">
                        <div class="col-xl-3 my-2">
                            <label for="bus-start">Buraya:</label>
                            <select id="bus-start" name="bus-start-station" class="form-select"
                                aria-label="Default select example">
                                <option selected disabled></option>
                                {% for city, stations in bus_destinations.items %}
                                <optgroup label="{{city}}">
                                    {% for station in stations %}
                                    <option value="{{station}}">{{station}}</option>
                                    {% endfor %}
                                </optgroup>
                                {% endfor %}
                            </select>
                        </div>
                        <div class="col-xl-3 my-2">
                            <label for="bus-arrive">Buraya:</label>
                            <select id="bus-arrive" name="bus-arrive-station" class="form-select"
                                aria-label="Default select example">
                                <option selected disabled></option>
                                {% for city, stations in bus_destinations.items %}
                                <optgroup label="{{city}}">
                                    {% for station in stations %}
                                    <option value="{{station}}">{{station}}</option>
                                    {% endfor %}
                                </optgroup>
                                {% endfor %}
                            </select>
                        </div>
                        <div class="col-xl-2 my-2">
                            <label for="start-date-1">Gedis: </label>
                            <input class="form-control date-input" type="date" name="bus-start-date" id="start-date-1">
                        </div>
                        <div class="col-xl-2 my-2">
                            <label for="arrive-date-1">Gelis: </label>
                            <input class="form-control date-input" type="date" name="bus-arrive-date" id="start-date-1">
                        </div>
                        <div class="col-xl-2 my-2 text-center d-flex flex-column justify-content-between">
                            <div></div>
                            <div>
                                <button class="btn btn-primary btn-search w-50" type="submit">Axtar</button>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="mt-3 form-wrapper form-train hidden">
                    <div class="row ps-1">
                        <h5>Qatar bileti</h5>
                    </div>
                    <div class="row">
                        <div class="col-xl-3 my-2">
                            <label for="bus-start">Buraya:</label>
                            <select id="bus-start" name="bus-start-station" class="form-select"
                                aria-label="Default select example">
                                <option selected disabled></option>
                                {% for city, stations in train_destinations.items %}
                                <optgroup label="{{city}}">
                                    {% for station in stations %}
                                    <option value="{{station}}">{{station}}</option>
                                    {% endfor %}
                                </optgroup>
                                {% endfor %}
                            </select>
                        </div>
                        <div class="col-xl-3 my-2">
                            <label for="bus-arrive">Buraya:</label>
                            <select id="bus-arrive" name="bus-arrive-station" class="form-select"
                                aria-label="Default select example">
                                <option selected disabled></option>
                                {% for city, stations in train_destinations.items %}
                                <optgroup label="{{city}}">
                                    {% for station in stations %}
                                    <option value="{{station}}">{{station}}</option>
                                    {% endfor %}
                                </optgroup>
                                {% endfor %}
                            </select>
                        </div>
                        <div class="col-xl-2 my-2">
                            <label for="start-date-1">Gedis: </label>
                            <input class="form-control date-input" type="date" name="bus-start-date" id="start-date-1">
                        </div>
                        <div class="col-xl-2 my-2">
                            <label for="arrive-date-1">Gelis: </label>
                            <input class="form-control date-input" type="date" name="bus-arrive-date" id="start-date-1">
                        </div>
                        <div class="col-xl-2 my-2 text-center d-flex flex-column justify-content-between">
                            <div></div>
                            <div>
                                <button class="btn btn-primary btn-search w-50" type='submit'>Axtar</button>
                            </div>
                        </div>
                    </div>
                </div>
            </form>
        </div>
    </div>
    <div class="container">

        {% if results %}
        {% for result in results %}
        <div class="card my-2">
            <div class="card-header">
                {% if option == 'bus-search' %}
                Avtobus
                {% elif option == 'train-search' %}
                Qatar
                {% endif %}
            </div>
            <div class="card-body">
                <h5 class="card-title">{{result.starting_point}} - {{result.destination}}</h5>
                <p class="card-text">
                    {{result.departures_at|date:"d/m/Y H:i"}} - {{result.arrives_at|date:"d/m/Y H:i"}}
                </p>
                <p class="card-text">{{result.ticket_price|floatformat:2}} ₼</p>
                <p class="card-text">
                    {% if result.seats_remain %}
                    {{result.seats_remain}} yer var
                    {% else %}
                    Biletler qalmayib
                    {% endif %}</p>
                <button class="add-button btn btn-primary" data-item_id="{{result.id}}" data-item_name="{{result}}"
                    data-item_price="{{result.ticket_price|floatformat:2}}"
                    data-item_starting_point="{{result.starting_point}}" data-item_destination="{{result.destination}}"
                    data-item_departures_at="{{result.departures_at|date:'d/m/Y H:i'}}" data-item_type="{{option}}"
                    data-item_arrives_at="{{result.arrives_at|date:'d/m/Y H:i'}}"
                    data-item_seats_remain="{{result.seats_remain}}">Əlavə
                    Et</button>
            </div>
        </div>
        {% endfor %}
        {% elif request.GET|length %}
        <div class="alert alert-danger" role="alert">Biletlər tapılmadı</div>
        {% endif %}
    </div>
</div>

<script src="{% static 'js/dashboard.js' %}"></script>

{% endblock %}